/*
  extremely rough sketch that sends some packets to the lord
*/

#include <AP_HAL/AP_HAL.h>

#if HAL_OS_POSIX_IO
#include <stdio.h>
#endif

void setup();
void loop();

const AP_HAL::HAL &hal = AP_HAL::get_HAL();
AP_HAL::UARTDriver *uart;

void setup(void) {

  hal.scheduler->delay(1000); //Ensure that the uartA can be initialized

  uart = hal.serial(1);
  uart->begin(115200);

  const uint8_t imu_format[] = {0x75, 0x65, 0x0C, 0x13, 0x13, 0x08, 0x01, 0x05, 0x17, 0x00, 0x0A, 0x06, 0x00, 0x0A, 0x04, 0x00, 0x0A, 0x05, 0x00, 0x0A, 0x0A, 0x00, 0x0A, 0x7C, 0x62};
  const uint8_t gnss_format[] = {0x75, 0x65, 0x0C, 0x13, 0x13, 0x09, 0x01, 0x05, 0x09, 0x00, 0x04, 0x0B, 0x00, 0x04, 0x03, 0x00, 0x04, 0x07, 0x00, 0x04, 0x05, 0x00, 0x04, 0x52, 0x00};
  const uint8_t save_formats[] = {0x75, 0x65, 0x0C, 0x08, 0x04, 0x08, 0x03, 0x00, 0x04, 0x09, 0x03, 0x00, 0x0D, 0x2E};
  const uint8_t enable_streams[] = {0x75, 0x65, 0x0C, 0x09, 0x05, 0x11, 0x01, 0x01, 0x01, 0x04, 0x11, 0x03, 0x01, 0x21, 0x9C};
  
  uart->write((const char *)imu_format);
  hal.scheduler->delay(1000);
  uart->write((const char *)gnss_format);
  hal.scheduler->delay(1000);
  uart->write((const char *)save_formats);
  hal.scheduler->delay(1000);
  uart->write((const char *)enable_streams);
}

void loop(void) {
  
}

AP_HAL_MAIN();
